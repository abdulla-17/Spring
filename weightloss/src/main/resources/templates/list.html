<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Your weights</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <style>
    /* small tweaks for pagination */
    .pagination { margin-top: 12px; }
    .pagination a, .pagination span { margin: 0 4px; padding: 6px 8px; text-decoration: none; border: 1px solid #ccc; border-radius: 4px; color: #333; }
    .pagination a:hover { background:#f0f0f0; }
    .pagination .active { font-weight:bold; background:#e9e9e9; }
    .pagination .disabled { color:#999; border-color:#eee; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Your Weights</h2>

    <p>
      <a th:href="@{/weights/add}">Add today's weight</a> |
      <form th:action="@{/logout}" method="post" style="display:inline; margin:0; padding:0;">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit" style="background:none;border:0;padding:0;color:#06c;cursor:pointer;font:inherit;text-decoration:underline;">Logout</button>
      </form>
    </p>

    <table>
      <thead><tr><th>Date</th><th>Weight (kg)</th><th>Added at</th><th>Actions</th></tr></thead>
      <tbody>
        <tr th:each="e : ${page.content}">
          <td th:text="${e.entryDate}">2025-01-01</td>
          <td th:text="${e.weightKg}">72.5</td>
          <td th:text="${#dates.format(e.createdAt, 'yyyy-MM-dd HH:mm:ss')}">time</td>
          <td>
            <a th:href="@{'/weights/edit/' + ${e.id}}">Edit</a> |
            <form th:action="@{'/weights/delete/' + ${e.id}}" method="post" style="display:inline; margin:0; padding:0;">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
              <button type="submit" onclick="return confirm('Delete this entry?');">Delete</button>
            </form>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- PAGINATION CONTROLS -->
    <div class="pagination" th:if="${page.totalPages > 1}">
      <!-- Prev -->
      <span th:if="${page.first}" class="disabled">Prev</span>
      <a th:if="${!page.first}"
         th:href="@{/weights(page=${currentPage-1}, size=${page.size})}">Prev</a>

      <!-- Page numbers (show up to 7 around current) -->
      <span th:each="i : ${#numbers.sequence(0, page.totalPages-1)}"
            th:if="${(i >= currentPage-3) and (i <= currentPage+3)}">
        <a th:if="${i != currentPage}"
           th:href="@{/weights(page=${i}, size=${page.size})}"
           th:text="${i + 1}">1</a>
        <span th:if="${i == currentPage}" th:text="${i + 1}" class="active">1</span>
      </span>

      <!-- Next -->
      <a th:if="${!page.last}"
         th:href="@{/weights(page=${currentPage+1}, size=${page.size})}">Next</a>
      <span th:if="${page.last}" class="disabled">Next</span>

      <!-- optional: show total pages and current -->
      <span style="margin-left:12px;">Page <span th:text="${currentPage + 1}"></span> of <span th:text="${page.totalPages}"></span></span>
    </div>

    <!-- optional page size selector -->
    <form method="get" th:action="@{/weights}" style="margin-top:8px;">
      <input type="hidden" name="page" value="0"/>
      <label>Show
        <select name="size" onchange="this.form.submit()">
          <option th:value="5" th:selected="${page.size==5}">5</option>
          <option th:value="10" th:selected="${page.size==10}">10</option>
          <option th:value="20" th:selected="${page.size==20}">20</option>
        </select>
        entries
      </label>
    </form>

    <h3>Find difference between dates</h3>
    <form th:action="@{/weights/diff}" method="get">
      <label>From: <input type="date" name="from" required/></label>
      <label>To: <input type="date" name="to" required/></label>
      <input type="hidden" name="page" th:value="${currentPage}"/>
      <input type="hidden" name="size" th:value="${page.size}"/>
      <button type="submit">Calculate</button>
    </form>

    <div th:if="${diff != null}">
      <p>Difference (start - end) = <span th:text="${diff}"></span> kg</p>
    </div>
    <div th:if="${diffError != null}">
      <p th:text="${diffError}"></p>
    </div>

  </div>
</body>
</html>
